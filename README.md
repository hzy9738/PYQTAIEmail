# 寻拟邮件工具

基于Python3和PyQt5的智能邮件自动化工具，支持163邮箱，提供可视化界面、定时任务和Python脚本动态生成邮件内容等强大功能。

## 功能特性

- ✅ **可视化界面**: 基于PyQt5的现代化GUI界面，支持Windows 10
- ✅ **163邮箱支持**: 完整支持163邮箱账号绑定和管理
- ✅ **群发邮件**: 支持批量发送邮件，可手动发送或定时发送
- ✅ **定时任务**: 可设置每天定时发送邮件
- ✅ **自动回复**: 自动监控收件箱并回复新邮件
- ✅ **Python脚本**: 支持使用Python脚本动态生成邮件内容(读取Excel、CSV等文件)
- ✅ **附件支持**: 支持添加多个附件
- ✅ **HTML邮件**: 支持HTML格式的邮件内容
- ✅ **系统托盘**: 支持最小化到系统托盘后台运行

## 系统��求

- **操作系统**: Windows 10 或更高版本
- **Python版本**: Python 3.7 或更高版本
- **网络**: 需要联网访问邮件服务器

## 安装部署

### 方式一: 使用可执行文件(推荐)

1. 下载最新的 `EmailService.exe` 可执行文件
2. 双击运行即可使用

### 方式二: 从源码安装

#### 步骤1: 安装Python

1. 访问 [Python官网](https://www.python.org/downloads/) 下载Python 3.7+
2. 安装时勾选 "Add Python to PATH"
3. 验证安装:
   ```bash
   python --version
   ```

#### 步骤2: 下载项目

```bash
git clone <项目地址>
cd PYQTAIEmail
```

#### 步骤3: 安装依赖

```bash
pip install -r requirements.txt
```

如果下载速度慢，可使用国内镜像:
```bash
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

#### 步骤4: 运行程序

```bash
python main.py
```

### 方式三: 打包成可执行文件

在Windows系统上运行打包脚本:

```bash
build.bat
```

打包完成后，可执行文件位于 `dist/EmailService.exe`

## 使用教程

### 1. 获取163邮箱授权码

使用本系统前，需要先获取163邮箱的授权码(不是登录密码):

1. 登录163邮箱网页版
2. 点击"设置" → "POP3/SMTP/IMAP"
3. 开启 "IMAP/SMTP服务"
4. 点击"生成授权码"或"客户端授权密码"
5. 按提示完成手机验证
6. 保存生成的授权码(16位字符)

### 2. 添加邮箱账号

1. 启动程序后,点击"邮箱账号"标签
2. 填写邮箱信息:
   - **邮箱地址**: 你的163邮箱地址
   - **授权码**: 上一步获取的授权码
   - **SMTP服务器**: smtp.163.com (默认)
   - **端口**: 465 (默认)
3. 点击"测试连接"验证配置
4. 测试成功后点击"添加账号"

### 3. 发送邮件

#### 单次发送

1. 切换到"发送邮件"标签
2. 选择发件账号
3. 输入收件人(支持多个,每行一个或用逗号分隔)
4. 选择内容模式:
   - **普通文本**: 直接输入邮件正文
   - **Python脚本**: 使用Python脚本动态生成邮件内容
5. 填写邮件主题和正文
6. (可选)添加附件
7. 点击"立即发送"

#### 批量发送

- 可以在收件人框直接粘贴多个邮箱地址
- 也可以点击"从文件导入收件人"导入txt文件
- 系统会自动分批发送,避免被限流

#### Python脚本模式(新功能)

支持使用Python脚本动态生成邮件内容,可以:
- 📊 读取Excel、CSV文件数据生成报表
- 📁 扫描目录批量处理文件
- 🕐 生成包含动态日期时间的内容
- 🔄 根据复杂逻辑动态生成个性化邮件

**内置Python环境**:
- ✅ 打包版本已内置Python运行时
- ✅ 已集成pandas、openpyxl、numpy等常用库
- ✅ 无需本地Python环境,开箱即用

**使用方法**:
1. 选择"Python脚本"模式
2. 在脚本编辑器中编写Python代码
3. 可以从模板库选择示例模板
4. 点击"测试脚本"验证脚本是否正常
5. 确认无误后发送邮件

**脚本示例**:
```python
# 读取Excel文件生成报表
import pandas as pd
from datetime import datetime

def generate_content():
    df = pd.read_excel(r"C:\data\sales.xlsx")
    content = f"销售报表 {datetime.now()}\n\n"
    content += df.head().to_string()
    return content
```

**详细文档**: 查看 [SCRIPT_GUIDE.md](SCRIPT_GUIDE.md) 获取完整使用指南

### 4. 定时任务

1. 切换到"定时任务"标签
2. 点击"添加定时任务"
3. 填写任务信息:
   - **任务名称**: 便于识别的任务名
   - **发件账号**: 选择发件邮箱
   - **收件人**: 多个收件人每行一个
   - **邮件主题**: 邮件标题
   - **邮件内容**: 邮件正文
   - **执行时间**: 每天执行的时间(如 09:30)
4. 点击"确定"添加任务
5. 任务会在每天指定时间自动发送

**注意**:
- 调度器必须保持运行状态
- 程序关闭后定时任务会停止
- 建议将程序最小化到系统托盘保持后台运行

### 5. 自动回复

1. 切换到"自动回复"标签
2. 选择要启用自动回复的邮箱账号
3. 编写自动回复的内容
4. 设置检查间隔(建议60秒以上)
5. 点击"保存配置"
6. 点击"启动自动回复"

**自动回复工作流程**:
- 定期检查收件箱的未读邮件
- 对每封新邮件自动发送回复
- 记录已回复邮件,避免重复回复
- 可随时停止自动回复

**注意事项**:
- 自动回复会持��运行直到手动停止
- 建议程序保持运行状态
- 可以最小化到系统托盘后台运行
- 检查间隔不要设置太短,避免频繁访问服务器

### 6. 系统托盘

- 点击窗口关闭按钮,程序会最小化到系统托盘
- 双击托盘图标可恢复窗口
- 右键托盘图标可选择"退出"完全关闭程序
- 托盘运行时,定时任务和自动回复会继续工作

## 常见问题

### Q1: 提示"认证失败,请检查邮箱和授权码"

- 确认使用的是授权码,而不是邮箱登录密码
- 确认授权码输入正确,没有多余空格
- 确认已在163邮箱开启IMAP/SMTP服务

### Q2: 发送邮件失败

- 检查网络连接是否正常
- 163邮箱可能有发送频率限制,不要短时间内发送过多邮件
- 检查收件人邮箱地址是否正确

### Q3: 定时任务没有执行

- 确认调度器处于"运行中"状态
- 确认任务的执行时间设置正确
- 检查系统时间是否准确
- 程序需要保持运行状态

### Q4: 自动回复不工作

- 确认已启动自动回复
- 检查IMAP服务是否开启
- 确认授权码正确
- 检查网络连接

### Q5: Windows Defender报警

这是正常现象,PyInstaller打包的程序可能被误报:
1. 点击"更多信息"
2. 选择"仍要���行"
3. 或添加到Windows Defender白名单

## 技术架构

- **界面框架**: PyQt5
- **邮件发送**: smtplib (SMTP SSL)
- **邮件接收**: imaplib (IMAP SSL)
- **任务调度**: schedule
- **配置加密**: cryptography (Fernet)
- **打包工具**: PyInstaller

## 项目结构

```
PYQTAIEmail/
├── main.py                 # 程序入口
├── main_window.py          # 主窗口
├── account_tab.py          # 账号管理标签页
├── send_email_tab.py       # 发送邮件标签页
├── schedule_tab.py         # 定时任务标签页
├── auto_reply_tab.py       # 自动回复标签页
├── config_manager.py       # 配置管理
├── email_sender.py         # 邮件发送模块
├── auto_reply.py           # 自动回复模块
├── task_scheduler.py       # 任务调度模块
├── script_executor.py      # Python脚本执行器(新)
├── requirements.txt        # 依赖包列表
├── build.spec             # PyInstaller配置
├── build.bat              # Windows打包脚本
├── README.md              # 说明文档
└── SCRIPT_GUIDE.md        # Python脚本使用指南(新)
```

## 注意事项

1. **安全性**
   - 授权码会加密存储在本地
   - 不要将配置文件分享给他人
   - 定期更换授权码

2. **邮件发送限制**
   - 163邮箱有发送频率限制
   - 建议控制发送频率
   - 大量发送可能被视为垃圾邮件

3. **网络要求**
   - 需要稳定的网络连接
   - 确保防火���允许程序访问网络
   - SMTP使用465端口,IMAP使用993端口

4. **资源占用**
   - 程序占用内存较少
   - 可长期后台运行
   - 建议最小化到托盘

## 许可证

MIT License

## 支持

如有问题或建议,请提交Issue。

---

**免责声明**: 本软件仅供学习和个人使用,请遵守相关法律法规,不得用于发送垃圾邮件等违法行为。
